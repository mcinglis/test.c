# Test.c

Test.c is a modern, simple testing library for C.

``` c
#include <test.h>

void * before_each( void )
{
    int const xs[] = { 2, 4, 8, 5 };
    int * const mem = malloc( sizeof( xs ) );
    memcpy( mem, xs, sizeof( xs ) );
    return mem;
}

void after_each( void * const data )
{
    int * const xs = data;
    free( xs );
}

struct TestAssertion * addition_works( void * const data )
{
    return test_assert( 3 + 8 == 11 );
}

struct TestAssertion * multiplication_works( void * const data )
{
    int * const xs = data;
    xs[ 2 ] = 3;
    return test_assert( 2 * 2 == 5,
                        3 * xs[ 2 ] == 9,
                        xs[ 1 ] * 4 != 16 );
}

struct TestAssertion * xs_is_increasing( void * const data )
{
    int const * const xs = data;
    for ( int i = 0; i < 4; i += 1 ) {
        TEST_REQUIRE( xs[ i ] <= xs[ i + 1 ],
                      i, xs[ i ], xs[ i + 1 ] );
    }
    return NULL;
}

struct Test const number_tests[] = TESTS_FIX( before_each, after_each,
    addition_works,
    multiplication_works,
    xs_is_increasing
);

int main( void ) {
    tests_run( "number", number_tests );
// Running number tests...
//     pass:  addition_works
//     fail:  multiplication_works
//         false:  2 * 2 == 5
//         false:  xs[ 1 ] * 4 != 16
//     fail:  xs_is_increasing
//         false:  xs[ i ] <= xs[ i + 1 ]
//             (for i = 2, xs[ i ] = 8, xs[ i + 1 ] = 5)
// Finished number tests: 1 passed, and 2 failed.

}
```

The `Test` and `TestAssertion` structs are `typedef`'d with the same name, so using `struct` with them is optional. I usually leave it off.

[`test.h`](/test.h) has the complete ("public") interface and documentation. There are examples in [`examples/`](/examples/) which are compiled with `make`. I heard you like tests, so Test.c's [tests](/tests/) are written with Test.c. You can read those for an extensive example of using Test.c, and to see its particular behaviors.

Files that include `test.h` need to be able to `#include <macromap.h/macromap.h>`, from [Macromap.h](https://github.com/mcinglis/macromap.h). Have a look at [Trie.c](https://github.com/mcinglis/trie.c) for an example of how to manage this (and for another example of using Test.c).


## Releases

I try to [tag](http://git-scm.com/book/en/Git-Basics-Tagging) the releases according to [semantic versioning v2.0.0](http://semver.org/spec/v2.0.0.html); the public interface is considered to be the things defined in `test.h` (and not things included in it, i.e. `assertion.h`). You can browse the releases [on GitHub](https://github.com/mcinglis/test.c/releases), but because this project uses [submodules](http://git-scm.com/book/en/Git-Tools-Submodules), the archives generated by GitHub won't compile. You have to clone this repository if you want to build it.


## Building

Test.c compiles with GCC 4.8 and Clang 3.3. It should compile with any C11 compiler that can [generate dependency files](/Makefile#L24).

``` sh
# To run the default development build (with debugging symbols):
$ make
# To build with optimizations and without debugging symbols:
$ CFLAGS='-std=c11 -O2' make
# To use your non-default C compiler:
$ CC=clang make
# If you don't have a C11 compiler, it can compile under C99 (for now):
$ CFLAGS='-std=c99' make
```

You'll have to run `git submodule update` after pulling a commit that updates a submodule.


## License

Copyright (C) 2013 Malcolm Inglis <http://minglis.id.au/>

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but **without any warranty**; without even the implied warranty of **merchantability** or **fitness for a particular purpose**. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with this program. If not, see <http://www.gnu.org/licenses/>.

Contact me if you'd like to use this program under different terms.

